<div id="randomCollectionsConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button">
    <div data-role="content">
        <div class="content-primary">
            <style>
                .inputContainer {
                    margin-bottom: 20px;
                }
                .fieldDescription {
                    margin-top: 5px;
                    font-size: 0.9em;
                    opacity: 0.8;
                }
                .status {
                    margin-top: 15px;
                    padding: 10px;
                    border-radius: 4px;
                    display: none;
                }
                .status.success {
                    background-color: rgba(0, 255, 0, 0.1);
                    color: #4ade80;
                    display: block;
                }
                .status.error {
                    background-color: rgba(255, 0, 0, 0.1);
                    color: #de4a4a;
                    display: block;
                }
            </style>

            <form id="randomCollectionsConfigForm">
                <h1>Random Collections Home Configuration</h1>
                
                <div class="inputContainer">
                    <label class="inputLabel" for="randomCount">Number of Random Collections:</label>
                    <input is="emby-input" type="number" id="randomCount" name="randomCount" min="1" value="3" />
                    <div class="fieldDescription">
                        The number of random collections to return via the API (default is 3).
                        Each user will get their own set of random collections.
                    </div>
                </div>

                <div>
                    <button is="emby-button" type="submit" class="raised button-submit block">
                        <span>Save</span>
                    </button>
                </div>
                
                <div id="statusMessage" class="status"></div>
            </form>

            <script type="text/javascript">
                var pluginId = "d9e7b57d-d417-4f0f-8ff9-4a6de3f42eab";

                document.getElementById('randomCollectionsConfigForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveSettings();
                    return false;
                });

                function loadSettings() {
                    ApiClient.getPluginConfiguration(pluginId).then(function(config) {
                        document.getElementById('randomCount').value = config.RandomCount || 3;
                    }).catch(function(error) {
                        console.error('Error loading settings:', error);
                    });
                }

                function saveSettings() {
                    Dashboard.showLoadingMsg();
                    
                    var randomCount = parseInt(document.getElementById('randomCount').value);
                    
                    if (randomCount < 1) {
                        Dashboard.hideLoadingMsg();
                        showStatus('Please enter a number of 1 or greater', 'error');
                        return;
                    }

                    ApiClient.getPluginConfiguration(pluginId).then(function(config) {
                        config.RandomCount = randomCount;
                        
                        ApiClient.updatePluginConfiguration(pluginId, config).then(function(result) {
                            Dashboard.processPluginConfigurationUpdateResult(result);
                            showStatus('Settings saved successfully! Changes will take effect immediately.', 'success');
                        }).catch(function(error) {
                            Dashboard.hideLoadingMsg();
                            console.error('Error saving settings:', error);
                            showStatus('Error saving settings: ' + error, 'error');
                        });
                    }).catch(function(error) {
                        Dashboard.hideLoadingMsg();
                        console.error('Error getting config:', error);
                        showStatus('Error loading configuration: ' + error, 'error');
                    });
                }

                function showStatus(message, type) {
                    var statusDiv = document.getElementById('statusMessage');
                    statusDiv.textContent = message;
                    statusDiv.className = 'status ' + type;
                    
                    setTimeout(function() {
                        statusDiv.className = 'status';
                    }, 5000);
                }

                // Load settings when page is ready
                loadSettings();
            </script>
        </div>
    </div>
</div>
